<!doctype html>
<html lang="en" itemscope itemtype="http://schema.org/Article">

    <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Enhance File Upload Security with PHP - Arka Roy</title>
    <meta name="description" content="We often face a situation where we need to provide our users a way to upload image, pdf, document etc. The basic html form for file upload is able to handle this with the help of PHP. The basic process of uploading user submitted files to the server with PHP is fairly easy and simple. But there should be some security measures. What will happen if a bad user uploads a malicious file to our server?

">
    <meta name="author" content="Arka Roy">
    <meta name="google-site-verification" content="Hoal6De7aoiiqdo7jTEmhXXXJo571pQuGeRjB3hY3-c">
    <meta name="msvalidate.01" content="AECE4670236DEBC0B41933B8F9A56547">
    <meta name="yandex-verification" content="5f83a425d7a76ae8">
    <meta name="p:domain_verify" content="a2b47611cc9905cb28e8b90214a6026b">
    <meta name="alexaVerifyID" content="sFRbCPL8KD91Vlkp8gjHT1-yX_o">
    <link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/assets/css/style.css">
    <link href="http://www.arkaroy.net/feed.xml" rel="alternate" type="application/atom+xml" title="Arka Roy">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/image/icon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/image/icon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/image/icon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/image/icon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/image/icon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/image/icon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/image/icon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/image/icon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/image/icon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/assets/image/icon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/image/icon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/image/icon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/image/icon/favicon-16x16.png">
    <!--
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    -->

    <link rel="author" href="https://plus.google.com/+ArkaRoyGPlus">
    <meta property="fb:admins" content="100000470507339">

    <!-- Schema.org markup for Google+ -->
    <meta itemprop="name" content="Enhance File Upload Security with PHP - Arka Roy">
    <meta itemprop="description" content="We often face a situation where we need to provide our users a way to upload image, pdf, document etc. The basic html form for file upload is able to handle this with the help of PHP. The basic process of uploading user submitted files to the server with PHP is fairly easy and simple. But there should be some security measures. What will happen if a bad user uploads a malicious file to our server?

">
    <meta itemprop="image" content="http://www.arkaroy.net/assets/image/default-thumbnail.jpg">

    <!-- Open Graph data for Facebook -->
    <meta property="og:title" content="Enhance File Upload Security with PHP - Arka Roy">
    <meta property="og:image" content="http://www.arkaroy.net/assets/image/default-thumbnail.jpg">
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://www.arkaroy.net/blog/enhance-file-upload-security-with-php/">
    <meta property="og:description" content="We often face a situation where we need to provide our users a way to upload image, pdf, document etc. The basic html form for file upload is able to handle this with the help of PHP. The basic process of uploading user submitted files to the server with PHP is fairly easy and simple. But there should be some security measures. What will happen if a bad user uploads a malicious file to our server?

">

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:url" content="http://www.arkaroy.net/blog/enhance-file-upload-security-with-php/">
    <meta name="twitter:title" content="Enhance File Upload Security with PHP - Arka Roy">
    <meta name="twitter:description" content="We often face a situation where we need to provide our users a way to upload image, pdf, document etc. The basic html form for file upload is able to handle this with the help of PHP. The basic process of uploading user submitted files to the server with PHP is fairly easy and simple. But there should be some security measures. What will happen if a bad user uploads a malicious file to our server?

">
    <meta name="twitter:image" content="http://www.arkaroy.net/assets/image/default-thumbnail.jpg">
    <meta name="twitter:site" content="@iarkaroy">
    <meta name="twitter:creator" content="@iarkaroy">

    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-61692534-1', 'auto');
        ga('send', 'pageview');

    </script>
</head>

    <body>
        

        <div class="page-wrapper">
            
            <div class="page-header">
                <div class="display-table">

    
    <header class="display-cell">

        <a href="http://www.arkaroy.net" class="logo">
            <i class="icon-arkaroy-logo"></i>
            <span>Arka Roy</span>
        </a>

        <p>I'm a passionate and proficient web designer and application developer residing in Kolkata, India.</p>

        <nav class="main-nav">

            <ul class="main-menu list-inline">
                <li><a href="/about/">About</a></li>
                <li class="menu-separator"></li>
                <li><a href="/portfolio/">Portfolio</a></li>
                <li class="menu-separator"></li>
                <li><a href="/blog/">Blog</a></li>
                <li class="menu-separator"></li>
                <li><a href="/contact/">Contact</a></li>
            </ul>                

        </nav>

    </header>
    

</div>
            </div>
            
            <div class="page-content">
                <form action="/search" method="get" class="search-form">
    <label class="search-label"><i class="fa fa-search"></i></label>
    <input type="text" name="q" class="search-q" placeholder="Search..." autocomplete="off">
    <button type="submit">Search</button>
</form>

<div class="entry post-entry single">

    <header class="entry-header">
        <h1 class="entry-title">Enhance File Upload Security with PHP</h1>
        <p class="entry-meta"><em>Sep 17, 2013 by Arka Roy</em></p>
        <div class="social-share clearfix" data-url="http://www.arkaroy.net/blog/enhance-file-upload-security-with-php/">
    
    <a class="twitter" href="https://twitter.com/intent/tweet?text=Enhance File Upload Security with PHP&url=http://www.arkaroy.net/blog/enhance-file-upload-security-with-php/&via=iarkaroy&related=iarkaroy" rel="nofollow" target="_blank" title="Share this on Twitter">
        <i class="fa fa-twitter"></i>
        <span class="shares-twitter">0</span>
    </a>
    
    <a class="facebook" href="https://www.facebook.com/sharer/sharer.php?t=Enhance File Upload Security with PHP&u=http://www.arkaroy.net/blog/enhance-file-upload-security-with-php/" rel="nofollow" target="_blank" title="Share this on Facebook">
        <i class="fa fa-facebook"></i>
        <span class="shares-facebook">0</span>
    </a>
    
    <a class="googleplus" href="https://plus.google.com/share?url=http://www.arkaroy.net/blog/enhance-file-upload-security-with-php/" rel="nofollow" target="_blank" title="Share this on Google Plus">
        <i class="fa fa-google-plus"></i>
        <span class="shares-googleplus">0</span>
    </a>
    
    <a class="linkedin" href="http://www.linkedin.com/shareArticle?mini=true&title=Enhance File Upload Security with PHP&url=http://www.arkaroy.net/blog/enhance-file-upload-security-with-php/" rel="nofollow" target="_blank" title="Share this on LinkedIn">
        <i class="fa fa-linkedin"></i>
        <span class="shares-linkedin">0</span>
    </a>
    
</div>
        
        <br>
        
    </header>

    <article class="entry-content">
        <p>We often face a situation where we need to provide our users a way to upload image, pdf, document etc. The basic html form for file upload is able to handle this with the help of PHP. The basic process of uploading user submitted files to the server with PHP is fairly easy and simple. But there should be some security measures. What will happen if a bad user uploads a malicious file to our server?</p>

<p>Here we will discuss some of this security measures to block the holes.</p>

<h2 id="the-form">The Form</h2>

<p>Before anything else, lets assume we have a form for the users to upload a file.</p>

<pre><code>&lt;form action="&lt;?php echo $_SERVER['PHP_SELF']; ?&gt;" method="post" enctype="multipart/form-data"&gt;
    &lt;label for="file"&gt;Select File:&lt;/label&gt;
    &lt;input type="file" name="file" id="file"&gt;
    &lt;input type="submit" name="upload" value="Upload File"&gt;
&lt;/form&gt;
</code></pre>

<p>Remember to use <code>method="post"</code> whenever using a form for file upload. As you are already aware of, <code>enctype="multipart/form-data"</code> is necessary because it tells the browser how to handle the data submitted as a file.</p>

<p><br /></p>

<h2 id="files-array"><code>$_FILES</code> Array</h2>

<p>As soon as the file uploads, its details become available in the PHP’s <code>$_FILES</code> superglobal array.</p>

<p>If you add the following lines at the top of your page,</p>

<pre><code>&lt;?php
    if(isset($_POST['upload'])) { // Checking whether the form has been submitted
        echo '&lt;pre&gt;';   
        print_r($_FILES);
        echo '&lt;/pre&gt;';
    }
?&gt;
</code></pre>

<p>and then you upload a file named flower.jpg. After you click ‘Upload File’ button, the details would be shown like this:</p>

<pre><code>Array
(
    [file] =&gt; Array
        (
            [name] =&gt; flower.jpg
            [type] =&gt; image/jpeg
            [tmp_name] =&gt; C:\xampp\tmp\php9F19.tmp
            [error] =&gt; 0
            [size] =&gt; 780831
        )

)
</code></pre>

<p><br /></p>

<h2 id="the-errors">The Errors</h2>

<p>Before we continue, lets take a look at the errors we can have. In the previous example, the <code>error</code> is <code>0</code> which means that there is no error and the file has been successfully uploaded.</p>

<p>Lets take a look at the various error codes and what they mean.</p>

<pre><code>0 =&gt; No Error
1 =&gt; Exceeds upload_max_filesize in PHP configuration
2 =&gt; Exceeds MAX_FILE_SIZE in hidden form field
3 =&gt; File partially uploaded
4 =&gt; No file to upload
6 =&gt; No temporary upload folder defined
7 =&gt; PHP failed to write to disk
8 =&gt; A PHP extension prevent the file to be uploaded
</code></pre>

<p><br /></p>

<h2 id="maxfilesize">MAX_FILE_SIZE</h2>

<p>In some cases, you might want to limit the size of the file to be uploaded. The <code>MAX_FILE_SIZE</code> field tells the browser to prevent the upload if it exceeds certain size. To use this feature, add the following code before the file input field.</p>

<pre><code>&lt;?php
    $max_size = 100 * 1024; // 100KB
?&gt;
&lt;input type="hidden" name="MAX_FILE_SIZE" value="&lt;?php echo $max_size; ?&gt;"&gt;
</code></pre>

<p>If a file larger than the size set, the error will be set to <code>2</code> and it will not be attempted to upload.</p>

<p><br /></p>

<h2 id="upload-directory">Upload Directory</h2>

<p>When setting or specifying a directory to store the uploaded files, it is much professional to consider some points before doing so.</p>

<p>The directory where the uploaded file will live, must be set writable. In Linux, permission to the folder must be set to at least 755 or 775.</p>

<p>If the files are going to be accessible by public, the directory can be under the root of the server. But if the files are protected or contains sensitive data, then it is much wiser to put the directory outside the scope of the server root so that it cannot be accessible via public url.</p>

<p><br /></p>

<h2 id="move-uploaded-file">Move Uploaded File</h2>

<p>It is necessary to move the uploaded file to the directory specified for the files. Otherwise, the uploaded file will be lost as it is just saved as a temporary file at first.</p>

<p>To move the uploaded file, we will use <code>move_uploaded_file()</code> method:</p>

<pre><code>&lt;?php
    if(isset($_POST['upload'])) { // Checking whether the form has been submitted
        ...
        $directory = __DIR__ . '/uploads/';
        if($_FILES['file']['error'] == 0) { // No error
            $result = move_uploaded_file($_FILES['file']['tmp_name'], $directory . $_FILES['file']['name']);
            if($result) {
                echo $_FILES['file']['name'] . ' has been successfully uploaded.';
            } else {
                echo 'There was a problem uploading ' . $_FILES['file']['name'];
            }
        }
        ...
    }
?&gt;
</code></pre>

<p>Now the uploaded files will the saved in the ‘uploads’ directory.</p>

<p>We have improved to some extent but there is a long path to go. We have not implemented any check on file types, file names and we have not provided any support for uploading multiple files. Also, if the uploaded files have same filename, the older one will be overwritten.</p>

<p>To avoid these situations and implement more validation, we will handle the upload a bit differently. We will <a href="http://www.arkaroy.net/blog/create-file-upload-class-in-php/">Create a File Upload Class in PHP</a> to handle the file upload more efficiently.</p>

    </article>
    
    <div class="tags">
    
        
        
        
        
        
        
        
    
    </div>
    
</div>

<div class="social-share clearfix" data-url="http://www.arkaroy.net/blog/enhance-file-upload-security-with-php/">
    
    <a class="twitter" href="https://twitter.com/intent/tweet?text=Enhance File Upload Security with PHP&url=http://www.arkaroy.net/blog/enhance-file-upload-security-with-php/&via=iarkaroy&related=iarkaroy" rel="nofollow" target="_blank" title="Share this on Twitter">
        <i class="fa fa-twitter"></i>
        <span class="shares-twitter">0</span>
    </a>
    
    <a class="facebook" href="https://www.facebook.com/sharer/sharer.php?t=Enhance File Upload Security with PHP&u=http://www.arkaroy.net/blog/enhance-file-upload-security-with-php/" rel="nofollow" target="_blank" title="Share this on Facebook">
        <i class="fa fa-facebook"></i>
        <span class="shares-facebook">0</span>
    </a>
    
    <a class="googleplus" href="https://plus.google.com/share?url=http://www.arkaroy.net/blog/enhance-file-upload-security-with-php/" rel="nofollow" target="_blank" title="Share this on Google Plus">
        <i class="fa fa-google-plus"></i>
        <span class="shares-googleplus">0</span>
    </a>
    
    <a class="linkedin" href="http://www.linkedin.com/shareArticle?mini=true&title=Enhance File Upload Security with PHP&url=http://www.arkaroy.net/blog/enhance-file-upload-security-with-php/" rel="nofollow" target="_blank" title="Share this on LinkedIn">
        <i class="fa fa-linkedin"></i>
        <span class="shares-linkedin">0</span>
    </a>
    
</div>

<br>

<div class="posts-nav-links clearfix">
    
    <a href="/blog/convert-relative-path-to-absolute-url-with-php/" class="next-post-link" title="Convert Relative Path to Absolute URL with PHP">
        <h4>Previous Post</h4>
        <h5>Convert Relative Path to Absolute URL with PHP</h5>
    </a>
    
    
    <a href="/blog/create-file-upload-class-in-php/" class="previous-post-link" title="Create a File Upload Class in PHP">
        <h4>Next Post</h4>
        <h5>Create a File Upload Class in PHP</h5>
    </a>
    
</div>
                <footer class="page-footer">
    <ul class="footer-menu list-inline">
        <li><i class="fa fa-copyright fa-fw"></i> 2015 Arka Roy</li>
        <li class="menu-separator"></li>
        <li><a href="http://www.facebook.com/iarkaroy" target="_blank" title="Facebook">Facebook</a></li>
        <li class="menu-separator"></li>
        <li><a href="http://www.twitter.com/iarkaroy" target="_blank" title="Twitter">Twitter</a></li>
        <li class="menu-separator"></li>
        <li><a href="https://plus.google.com/+ArkaRoyGPlus" target="_blank" title="Google+">Google+</a></li>
        <li class="menu-separator"></li>
        <li><a href="https://www.linkedin.com/in/iarkaroy" target="_blank" title="LinkedIn">LinkedIn</a></li>
        <li class="menu-separator"></li>
        <li><a href="http://www.behance.net/iarkaroy" target="_blank" title="Behance">Behance</a></li>
        <li class="menu-separator"></li>
        <li><a href="http://www.github.com/iarkaroy" target="_blank" title="Github">Github</a></li>
    </ul>    
</footer>

<!-- jQuery from CDN -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="/assets/js/script.js"></script>
<script src="/assets/js/search.js"></script>
<script src="/assets/js/social-popularity-analyzer.js"></script>
            </div>        
            
        </div>
        

    </body>
</html>